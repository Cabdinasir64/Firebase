<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Real-Time To-Do List</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore-compat.js"></script>
    <style>
      @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
      body {
        font-family: 'Inter', sans-serif;
      }
      .task-item {
        transition: all 0.2s ease;
      }
      .task-item:hover {
        transform: translateY(-2px);
      }
      .checkbox:checked + .task-text {
        color: #9CA3AF;
      }
      .notification {
        transition: opacity 0.3s ease;
      }
    </style>
  </head>

  <body class="bg-gray-50 min-h-screen flex items-start py-12 justify-center">
    <div class="p-6 bg-white rounded-2xl shadow-xl w-full max-w-2xl mx-4">
      <!-- Header -->
      <div class="flex items-center justify-between mb-8">
        <div>
          <h1 class="text-3xl font-bold text-gray-800">Task Manager</h1>
          <p class="text-gray-500 mt-1">Organize your work and life</p>
        </div>
        <div class="bg-blue-100 p-3 rounded-full">
          <i class="fa fa-tasks text-xl text-blue-600"></i>
        </div>
      </div>

      <!-- Add Task Form -->
      <form id="task-form" class="mb-8">
        <div class="flex gap-3">
          <div class="flex-1 relative">
            <input
              type="text"
              placeholder="What needs to be done?"
              id="task-input"
              class="w-full px-5 py-4 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent text-gray-700 placeholder-gray-400"
              autocomplete="off"
            />
            <span id="input-error" class="absolute left-0 -bottom-5 text-xs text-red-500 hidden">Please enter a task</span>
          </div>
          <button
            type="submit"
            id="submit-btn"
            class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-4 rounded-xl font-semibold transition-colors shadow-md hover:shadow-lg active:scale-95 flex items-center gap-2"
          >
            <i class="fa fa-plus"></i>
            <span>Add</span>
          </button>
        </div>
      </form>

      <!-- Filters -->
      <div class="bg-gray-50 p-5 rounded-xl mb-8 border border-gray-100">
        <h5 class="text-sm font-semibold text-gray-600 mb-4 uppercase tracking-wider">Filters</h5>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm text-gray-600 mb-2">Status</label>
            <select
              id="status-filter"
              class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-gray-700"
            >
              <option value="all">All Tasks</option>
              <option value="active">Active</option>
              <option value="completed">Completed</option>
            </select>
          </div>
          <div>
            <label class="block text-sm text-gray-600 mb-2">Sort By</label>
            <select
              id="sort-filter"
              class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-gray-700"
            >
              <option value="newest">Newest First</option>
              <option value="oldest">Oldest First</option>
            </select>
          </div>
          <div>
            <label class="block text-sm text-gray-600 mb-2">Items to Show</label>
            <input
              type="number"
              min="1"
              placeholder="All"
              id="limit-filter"
              class="w-full px-4 py-3 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-400 bg-white text-gray-700"
            />
          </div>
        </div>
      </div>

      <!-- Task Stats -->
      <div class="flex justify-between items-center mb-4">
        <div class="text-sm text-gray-500">
          <span id="total-tasks">0</span> tasks total
        </div>
        <div class="text-sm text-gray-500">
          <span id="completed-tasks">0</span> completed
        </div>
      </div>

      <!-- Task List -->
      <ul id="task-list" class="space-y-3">
        <div id="empty-state" class="text-center py-12">
          <i class="fa fa-tasks text-4xl text-gray-300 mb-4"></i>
          <p class="text-gray-500">No tasks yet. Add one above!</p>
        </div>
      </ul>
    </div>

    <script>
      // Firebase Configuration
      const firebaseConfig = {
        apiKey: "AIzaSyBj7DO_yftf1ViNQ0l5hrPBkbFFgc9un_8",
        authDomain: "tests-18ea8.firebaseapp.com",
        projectId: "tests-18ea8",
        storageBucket: "tests-18ea8.firebasestorage.app",
        messagingSenderId: "35376357331",
        appId: "1:35376357331:web:2d70f7605428112b8c1926",
        measurementId: "G-7G473JZWZG",
      };

      // Initialize Firebase
      firebase.initializeApp(firebaseConfig);
      const db = firebase.firestore();

    
      const taskForm = document.getElementById('task-form');
      const taskInput = document.getElementById('task-input');
      const submitBtn = document.getElementById('submit-btn');
      const taskList = document.getElementById('task-list');
      const emptyState = document.getElementById('empty-state');
      const inputError = document.getElementById('input-error');
      const statusFilter = document.getElementById('status-filter');
      const sortFilter = document.getElementById('sort-filter');
      const limitFilter = document.getElementById('limit-filter');
      const totalTasksEl = document.getElementById('total-tasks');
      const completedTasksEl = document.getElementById('completed-tasks');

      
      let isEditing = false;
      let currentEditId = null;
      let unsubscribe = null; 


      document.addEventListener('DOMContentLoaded', () => {
        setupRealTimeListener();
        
        
        taskForm.addEventListener('submit', handleSubmit);
        statusFilter.addEventListener('change', setupRealTimeListener);
        sortFilter.addEventListener('change', setupRealTimeListener);
        limitFilter.addEventListener('change', setupRealTimeListener);
      });

    
      function setupRealTimeListener() {
        
        if (unsubscribe) unsubscribe();
        
        let query = db.collection('tasks');
        
        
        const status = statusFilter.value;
        if (status === 'active') {
          query = query.where('completed', '==', false);
        } else if (status === 'completed') {
          query = query.where('completed', '==', true);
        }
        
    
        const sort = sortFilter.value;
        if (sort === 'newest') {
          query = query.orderBy('createdAt', 'desc');
        } else if (sort === 'oldest') {
          query = query.orderBy('createdAt', 'asc');
        }
        
    
        const limit = parseInt(limitFilter.value);
        if (!isNaN(limit)) {
          query = query.limit(limit);
        }
        
        
        unsubscribe = query.onSnapshot(snapshot => {
          const tasks = snapshot.docs.map(doc => ({
            id: doc.id,
            ...doc.data()
          }));
          
          renderTasks(tasks);
          updateStats(tasks);
        }, error => {
          console.error('Error listening to tasks:', error);
          showNotification('Error loading tasks', 'error');
        });
      }

      
      async function handleSubmit(e) {
        e.preventDefault();
        
        const taskText = taskInput.value.trim();
        
        if (!taskText) {
          inputError.classList.remove('hidden');
          taskInput.classList.add('border-red-500');
          return;
        }
        
        inputError.classList.add('hidden');
        taskInput.classList.remove('border-red-500');
        
        try {
          if (isEditing) {
            await updateTask(currentEditId, taskText);
            showNotification('Task updated successfully');
          } else {
            await addTask(taskText);
            showNotification('Task added successfully');
          }
          
          taskInput.value = '';
          isEditing = false;
          currentEditId = null;
          submitBtn.innerHTML = '<i class="fa fa-plus"></i><span>Add</span>';
        } catch (error) {
          console.error('Error:', error);
          showNotification('Error processing task', 'error');
        }
      }

      async function addTask(taskText) {
        const newTask = {
          text: taskText,
          completed: false,
          createdAt: firebase.firestore.FieldValue.serverTimestamp(),
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        };
        
        await db.collection('tasks').add(newTask);
      }

      async function updateTask(id, newText) {
        await db.collection('tasks').doc(id).update({
          text: newText,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      }

      async function toggleTaskCompletion(id) {
        const docRef = db.collection('tasks').doc(id);
        const doc = await docRef.get();
        
        if (!doc.exists) {
          showNotification('Task not found', 'error');
          return;
        }
        
        await docRef.update({
          completed: !doc.data().completed,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
      }

      async function deleteTask(id) {
        if (confirm('Are you sure you want to delete this task?')) {
          await db.collection('tasks').doc(id).delete();
          showNotification('Task deleted');
        }
      }

      function editTask(id) {
        const taskItems = document.querySelectorAll('.task-item');
        
        for (let item of taskItems) {
          if (item.dataset.id === id) {
            const taskText = item.querySelector('.task-text').textContent;
            isEditing = true;
            currentEditId = id;
            taskInput.value = taskText;
            taskInput.focus();
            submitBtn.innerHTML = '<i class="fa fa-save"></i><span>Update</span>';
            break;
          }
        }
      }

      function renderTasks(tasks) {
        if (tasks.length === 0) {
          emptyState.classList.remove('hidden');
          taskList.innerHTML = '';
          return;
        }
        
        emptyState.classList.add('hidden');
        taskList.innerHTML = '';
        
        tasks.forEach(task => {
          const taskEl = document.createElement('li');
          taskEl.className = `task-item bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md ${
            task.completed ? 'opacity-80' : ''
          }`;
          taskEl.dataset.id = task.id;
          
          taskEl.innerHTML = `
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3 flex-1">
                <input 
                  type="checkbox" 
                  ${task.completed ? 'checked' : ''}
                  class="checkbox h-5 w-5 rounded border-gray-300 text-blue-600 focus:ring-blue-500 cursor-pointer"
                >
                <span class="task-text ${task.completed ? 'line-through text-gray-400' : 'text-gray-700'}">
                  ${task.text}
                </span>
              </div>
              <div class="flex gap-2 ml-4">
                <button 
                  class="edit-btn text-blue-500 hover:text-blue-700 p-2 rounded-full hover:bg-blue-50 transition-colors"
                  title="Edit"
                >
                  <i class="fa fa-pencil-alt"></i>
                </button>
                <button 
                  class="delete-btn text-red-500 hover:text-red-700 p-2 rounded-full hover:bg-red-50 transition-colors"
                  title="Delete"
                >
                  <i class="fa fa-trash-alt"></i>
                </button>
              </div>
            </div>
            <div class="text-xs text-gray-400 mt-2">
              ${formatDate(task.createdAt?.toDate())}
            </div>
          `;
          
          const checkbox = taskEl.querySelector('.checkbox');
          const editBtn = taskEl.querySelector('.edit-btn');
          const deleteBtn = taskEl.querySelector('.delete-btn');
          
          checkbox.addEventListener('click', () => toggleTaskCompletion(task.id));
          editBtn.addEventListener('click', () => editTask(task.id));
          deleteBtn.addEventListener('click', () => deleteTask(task.id));
          
          taskList.appendChild(taskEl);
        });
      }

      function updateStats(tasks) {
        totalTasksEl.textContent = tasks.length;
        const completedCount = tasks.filter(t => t.completed).length;
        completedTasksEl.textContent = completedCount;
      }

      function formatDate(date) {
        if (!date) return '';
        return new Intl.DateTimeFormat('en-US', {
          month: 'short',
          day: 'numeric',
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        }).format(date);
      }

      function showNotification(message, type = 'success') {
        const notification = document.createElement('div');
        notification.className = `notification fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg text-white ${
          type === 'success' ? 'bg-green-500' : 'bg-red-500'
        }`;
        notification.textContent = message;
        document.body.appendChild(notification);
        
        setTimeout(() => {
          notification.classList.add('opacity-0');
          setTimeout(() => notification.remove(), 300);
        }, 1000);
      }

     
      window.addEventListener('beforeunload', () => {
        if (unsubscribe) unsubscribe();
      });
    </script>
  </body>
</html>